---
phase: 01-spec-driven-architecture
plan: 02
type: execute
---

<objective>
Update the initializer agent to generate specs/ directory with markdown spec files from the app specification.

Purpose: Shift the source of truth from database-first to specs-first, where the initializer creates human-readable markdown specs that are then loaded into the database for runtime tracking.
Output: Modified initializer prompt and updated project templates supporting specs/ pattern.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Depends on 01-01:**
@docs/spec-format.md - Spec format documentation
@spec_parser.py - Spec parser module

**Current Implementation:**
@.claude/templates/initializer_prompt.template.md - Current initializer prompt
@.claude/templates/app_spec.template.txt - App spec template

**Key Change:**
Instead of: Initializer reads app_spec.txt → calls feature_create_bulk → features in SQLite
New flow: Initializer reads app_spec.txt → writes specs/*.md files → parser loads to SQLite
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update initializer prompt to generate specs</name>
  <files>.claude/templates/initializer_prompt.template.md</files>
  <action>
Modify the initializer prompt template to generate specs/ instead of calling feature_create_bulk directly:

1. Replace the "Create Features" section with "Create Specs" section that:
   - Creates `specs/` directory in project root
   - Writes one .md file per feature/test case
   - Uses the format from docs/spec-format.md
   - Files named by sanitized feature name (lowercase, hyphens)

2. Add instruction to call feature_create_bulk AFTER specs are created:
   - Read specs using the pattern from spec_parser.py
   - Or simply note that the coding agent will load specs on first run

3. Update the category/test distribution guidance to apply to spec files

4. Keep the mandatory test categories section - these guide spec creation

5. Update git commit instructions to include specs/ directory

Key changes:
- Remove direct feature_create_bulk call with JSON
- Add spec file creation workflow
- Maintain same test coverage requirements
- Add AGENTS.md creation (operational reference)

The prompt should instruct the agent to create files like:
```
specs/
  01-user-login-with-email.md
  02-user-registration.md
  03-password-reset-flow.md
  ...
```

Priority encoded in filename prefix (01-, 02-, etc.) for natural sorting.

Do NOT remove the mandatory test categories - they provide essential coverage guidance.
The categories should guide what spec files to create.
  </action>
  <verify>
# Check the updated prompt has spec creation workflow
grep -q "specs/" .claude/templates/initializer_prompt.template.md && echo "specs/ mentioned"
grep -q "\.md" .claude/templates/initializer_prompt.template.md && echo "markdown files mentioned"
# Verify mandatory categories still present
grep -q "MANDATORY TEST CATEGORIES" .claude/templates/initializer_prompt.template.md && echo "Categories preserved"
  </verify>
  <done>
- Initializer prompt instructs agent to create specs/ directory
- Prompt includes spec file format instructions
- Mandatory test categories preserved for coverage guidance
- Git commit section updated to include specs/
  </done>
</task>

<task type="auto">
  <name>Task 2: Update project templates for specs pattern</name>
  <files>.claude/templates/agents.template.md</files>
  <action>
Create AGENTS.md template for the Ralph Wiggum operational reference pattern:

1. Create `.claude/templates/agents.template.md` with:
   - Project overview (brief)
   - Build commands (npm/pip install, build, test, lint)
   - Run commands (dev server, production)
   - Test commands (unit, integration, e2e)
   - Key file locations
   - Keep under 60 lines (Ralph Wiggum guidance)

2. This file serves as quick reference for agents:
   - No need to read full app_spec.txt for basic operations
   - Commands are project-specific, filled by initializer
   - Updated by coding agent as project evolves

Template structure:
```markdown
# AGENTS.md - Operational Reference

## Quick Start
[filled by initializer based on stack]

## Commands
- **Install**: `[command]`
- **Dev**: `[command]`
- **Build**: `[command]`
- **Test**: `[command]`
- **Lint**: `[command]`

## Key Locations
- Frontend: `[path]`
- Backend: `[path]`
- Specs: `specs/`
- Database: `features.db`

## Notes
[any project-specific operational notes]
```

Do NOT make this template complex - it should be under 60 lines.
The initializer will fill in project-specific values.
  </action>
  <verify>
cat .claude/templates/agents.template.md
wc -l .claude/templates/agents.template.md | awk '{print "Lines:", $1}'
  </verify>
  <done>
- agents.template.md created with operational reference structure
- Template is under 60 lines
- Template includes commands, locations, and notes sections
- Ready for initializer to customize per project
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] Initializer prompt updated with specs/ workflow
- [ ] Mandatory test categories preserved
- [ ] agents.template.md exists and is under 60 lines
- [ ] Templates are valid markdown
- [ ] No syntax errors in templates
</verification>

<success_criteria>
- Initializer agent will generate specs/ directory
- AGENTS.md pattern established for operational reference
- Ready for MCP server integration in 01-03
</success_criteria>

<output>
After completion, create `.planning/phases/01-spec-driven-architecture/01-02-SUMMARY.md` following the summary template.
</output>
